{"version":3,"sources":["res/date/calendar-popup.js"],"names":[],"mappings":"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","file":"res/date/calendar-popup.js","sourcesContent":["import * as chs from '../chs';\r\n\r\nvar MonthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\n\r\n\r\n//Singleton datepicker popup for cs-date\r\n//----------------------------------------------------------------------------------------\r\nexport class CalendarPopup\r\n{\r\n    constructor()\r\n    {\r\n        var self = this, doc = document;\r\n        self.curCtrl = null;               //Stores a reference to the current cs-date ctrl this calendar is working with\r\n        \r\n        //Append a <div class='cs-cal'> element to the document body.\r\n        self.element = doc.createElement(\"div\");\r\n        self.element.className = 'cs-cal cs-hidden';\r\n        doc.body.appendChild(self.element);\r\n        \r\n        //Wire document events\r\n        doc.addEventListener('mousedown', (ev) =>\r\n        {\r\n            var target = ev.target;\r\n            var tEl = chs.closest(target, \".cs-cal\");           //If mousedown on calendar\r\n            if(tEl) { return;}      \r\n           \r\n            tEl = chs.closest(target, \".cs-date\");              //If mousedown on cs-date ctrl\r\n            if(tEl) { return; }           \r\n            \r\n            self.hide();\r\n        });\r\n\r\n        doc.addEventListener('mouseup', (ev) =>\r\n        {\r\n            var target = ev.target;\r\n            var tEl    = chs.closest(target, \".cs-date-btn\");      //Show calendar button of a ctrl\r\n            if(tEl) \r\n            {\r\n                self.curCtrl = tEl.parentNode.primaryBehavior.executionContext;\r\n                self.show();\r\n                return;\r\n            }\r\n            \r\n            tEl = chs.closest(target, \".cs-cal-prev\");             //Prev button on calendar\r\n            if(tEl) { return self.changeMonth(-1); }\r\n\r\n            tEl = chs.closest(target, \".cs-cal-next\");             //Next button on calendar\r\n            if(tEl) { return self.changeMonth(1); }\r\n            \r\n            tEl = chs.closest(target, \".cs-cal-cell-content\");     //Calendar day cell\r\n            if(tEl) \r\n            { \r\n                self.curCtrl.value = new Date(self.lastDt.getFullYear(), self.lastDt.getMonth(), tEl.innerText);\r\n                return self.hide();\r\n            }\r\n        });\r\n\r\n    }\r\n    \r\n    hide()\r\n    {\r\n        this.element.classList.add(\"cs-hidden\");\r\n        this.lastDt = null;  //Clear out last so on next show we'll render from the ctrl's date\r\n    }\r\n    \r\n    show()\r\n    {\r\n        this.render();\r\n        this.position();\r\n        this.element.classList.remove(\"cs-hidden\");\r\n    }\r\n\r\n\r\n    //Increments/decrements the rendered month\r\n    changeMonth(delta)\r\n    {\r\n        var lDt = this.lastDt;\r\n        lDt.setDate(1);          //I think this may prevent wierd edgecase errors like adding to the 31st day of a month\r\n        lDt.setMonth(lDt.getMonth() + delta);\r\n        this.render(lDt);\r\n    }\r\n\r\n\r\n\r\n    render(dt)\r\n    {\r\n        var self = this, ctrl = self.curCtrl, ctrlDt = ctrl.value;\r\n\r\n        var dt = dt || ctrlDt || new Date();\r\n        dt = new Date(dt.getTime());                     //Ensure we work with a clone if using the ctrl's date\r\n\r\n        var month       = dt.getMonth();\r\n        var year        = dt.getFullYear();\r\n        var firstDayDt  = new Date(year, month, 1);      //1st date of the month\r\n        var startDay    = firstDayDt.getDay();           //That day's day number (0-6)\r\n        var todayDt     = new Date();\r\n        var today       = -1;                            //Today's day number. -1 if today's date doesn't fall within the calendar month we are rendering.\r\n        var activeDay   = -1;                            //Day number of the currently selected date. -1 if one doesn't exist within the calendar month we are rendering.\r\n\r\n        //Record that this was the last date we rendered with\r\n        self.lastDt = dt;\r\n\r\n        //Get total days in the month\r\n        dt = new Date(year, month + 1, 0);\r\n        var daysInMonth = dt.getDate();\r\n        \r\n        //Explanation of the above:\r\n        //Date constructor attempts to convert year/month/day values to the nearest valid date. Month is incremented to get the following month, then a Date object is created with zero days. \r\n        //Since this is invalid, the Date object defaults to the last valid day of the previous month which is the month we're actually interested in. \r\n        //Then getDate() returns the day (1-31) of that date, & that gives us the number of days in that month. As a bonus this handles leap year too.\r\n        \r\n\r\n        //Determine if the month we're rendering includes today's date\r\n        if(month == todayDt.getMonth() && year == todayDt.getFullYear())\r\n        {\r\n            today = todayDt.getDate();\r\n        }\r\n        \r\n        //Determine if the month we're rendering includes the currently selected date\r\n        if(ctrlDt && month == ctrlDt.getMonth() && year == ctrlDt.getFullYear())\r\n        {\r\n            activeDay = ctrlDt.getDate();\r\n        }\r\n        \r\n        var html = `<div class='cs-cal-hdr'>\r\n                        <a class='cs-cal-prev'><i class='cs-cal-prev-ico'></i></a>\r\n                        <div class='cs-cal-title'>` + MonthName[month] + ' ' + year + `</div>\r\n                        <a class='cs-cal-next'><i class='cs-cal-next-ico'></i></a>\r\n                    </div>\r\n                    <table class='cs-cal-tbl'>\r\n                        <tr class='cs-cal-dayrow'>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Su</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Mo</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Tu</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>We</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Th</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Fr</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Sa</span></th>\r\n                        </tr><tr>`;\r\n\r\n        //Build day cells\r\n        var w = 0, d, dayCount = 1;\r\n        for (; w < 6; w++)           //Week loop (6 rows may be more than we need. We'll break out before if so.)\r\n        {\r\n            for (d = 0; d < 7; d++)  //Day loop (cells)\r\n            {\r\n                if (dayCount <= daysInMonth && (w > 0 || d >= startDay))     //Fill the cell if we still have days left, & we're not on the 1st row, or this day is >= the starting day for the month\r\n                {\r\n                    if(dayCount == today)                                                                             //Today's date cell\r\n                    {\r\n                        html += \"<td class='cs-cal-cell'><div class='cs-cal-cell-content cs-today'>\" + dayCount + \"</div></td>\"; \r\n                    }\r\n                    else if(dayCount == activeDay)                                                                    //Currently selected date\r\n                    {\r\n                        html += \"<td class='cs-cal-cell cs-active'><div class='cs-cal-cell-content'>\" + dayCount + \"</div></td>\"; \r\n                    }\r\n                    else                                                                                              //Normal date cell\r\n                    {\r\n                        html += \"<td class='cs-cal-cell'><div class='cs-cal-cell-content'>\" + dayCount + \"</div></td>\"; \r\n                    }\r\n                    dayCount++;\r\n                }\r\n                else\r\n                {\r\n                    html += '<td class=\"cs-cal-cell cs-cal-cell-blank\"></td>';           //Empty cell\r\n                }\r\n            }\r\n            if(dayCount > daysInMonth) { break; }\r\n            html += \"</tr><tr>\";\r\n        }\r\n        html += \"</tr></table>\";\r\n\r\n        self.element.innerHTML = html;\r\n    }\r\n    \r\n    position()\r\n    {\r\n        var ctrlEl      = this.curCtrl.element,         //The DOM element for the control we are attaching this DDL to\r\n            ctrlPos     = chs.jqOffset(ctrlEl),         //Coordinates relative to the document\r\n            cal         = this.element,                 //The calendar element\r\n            ctrlHeight  = ctrlEl.offsetHeight,          //Height of the control we're attached to\r\n            y           = ctrlPos.top + ctrlHeight,     //Y position directly below ctrl\r\n            wh          = window.innerHeight,           //Height of the browser viewport including, if rendered, the horizontal scrollbar\r\n            topSpace    = ctrlPos.top,                  //Space available above ctrl\r\n            botSpace    = (wh - y);                     //Space available below ctrl\r\n            \r\n\r\n        //Set cal left position\r\n        cal.style.left   = ctrlPos.left + 'px';\r\n       \r\n        \r\n        //If cal would extend beyond the window assume it's better to show above the control *IF* topSpace has more room\r\n        if ((y + cal.offsetHeight) > wh) \r\n        {\r\n            if (topSpace > botSpace) //Top space has more room so put above the ctrl\r\n            {\r\n                //borderTop = true;\r\n                y = ctrlPos.top - cal.offsetHeight - 1;\r\n            }\r\n        }\r\n \r\n        //Set top position\r\n        cal.style.top = y + 'px';\r\n        \r\n        //Assign top/bottom border\r\n//        if(borderTop)\r\n//        {\r\n//            ddl.style.borderTopStyle    = 'solid';\r\n//            ddl.style.borderBottomStyle = 'none';\r\n//        }\r\n//        else\r\n//        {\r\n//            ddl.style.borderBottomStyle = 'solid';\r\n//            ddl.style.borderTopStyle    = 'none';\r\n//        }\r\n    }\r\n}"],"sourceRoot":"/source/"}