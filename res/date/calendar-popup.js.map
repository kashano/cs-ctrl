{"version":3,"sources":["res/date/calendar-popup.js"],"names":[],"mappings":"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","file":"res/date/calendar-popup.js","sourcesContent":["import * as chs from '../chs';\r\n\r\nvar MonthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\n\r\nvar PrevButtonCSS  = 'cs-cal-prev',\r\n    NextButtonCSS  = 'cs-cal-next',\r\n    CellContentCSS = 'cs-cal-cell-content';\r\n\r\n//Singleton calendar (datepicker) popup for cs-date\r\n//----------------------------------------------------------------------------------------\r\nexport class CalendarPopup\r\n{\r\n    constructor()\r\n    {\r\n        var self = this;\r\n        self.curCtrl = null;               //Stores a reference to the current cs-date ctrl this calendar is working with\r\n        \r\n        //Append a <div class='cs-cal'> element to the document body.\r\n        self.element = document.createElement(\"div\");\r\n        self.element.className = 'cs-cal cs-hidden';\r\n        document.body.appendChild(self.element);\r\n    }\r\n    \r\n    wireEvents()\r\n    {\r\n        var self = this;\r\n        \r\n        if(self.mousedownHandler) { return; }   //Don't allow multiple sets of event handlers\r\n        \r\n        //Mouse Down\r\n        self.mousedownHandler = function(ev)\r\n        {\r\n            var target = ev.target;\r\n            \r\n            //If mousedown on calendar\r\n            if(self.element.contains(target)) { return; }           \r\n            \r\n            //If mousedown on current cs-date ctrl\r\n            if(self.curCtrl && self.curCtrl.element.contains(target)) { return; }\r\n            \r\n            self.hide();\r\n        };\r\n        \r\n        //Mouse Up\r\n        self.mouseupHandler = function(ev)\r\n        {\r\n            var cl = ev.target.classList;\r\n            \r\n            if(cl.contains(PrevButtonCSS)) { return self.changeMonth(-1); }   //Prev button on calendar\r\n            if(cl.contains(NextButtonCSS)) { return self.changeMonth(1);  }   //Next button on calendar\r\n\r\n            if(cl.contains(CellContentCSS))                                   //Calendar day cell\r\n            {\r\n                self.curCtrl.value = new Date(self.lastDt.getFullYear(), self.lastDt.getMonth(), ev.target.innerText);\r\n                return self.hide();\r\n            }\r\n        };\r\n        \r\n        document.addEventListener('mousedown', self.mousedownHandler);\r\n        document.addEventListener('mouseup', self.mouseupHandler);\r\n    }\r\n    \r\n    removeEvents()\r\n    {\r\n        var self = this;\r\n        document.removeEventListener('mousedown', self.mousedownHandler);\r\n        document.removeEventListener('mouseup', self.mouseupHandler);\r\n        self.mousedownHandler = null;\r\n        self.mouseupHandler   = null;\r\n    }\r\n    \r\n    hide()\r\n    {\r\n        var self    = this;\r\n        self.isOpen = false;\r\n        self.lastDt = null;  //Clear out last so on next show we'll render from the ctrl's date\r\n        self.element.classList.add(\"cs-hidden\");\r\n        self.removeEvents();\r\n    }\r\n    \r\n    show(ctrl)\r\n    {\r\n        var self    = this;\r\n        self.isOpen = true;\r\n        if(ctrl) { self.curCtrl = ctrl; }\r\n        self.render();\r\n        self.position();\r\n        self.element.classList.remove(\"cs-hidden\");\r\n        self.wireEvents();\r\n    }\r\n\r\n\r\n    //Increments/decrements the rendered month\r\n    changeMonth(delta)\r\n    {\r\n        var lDt = this.lastDt;\r\n        lDt.setDate(1);          //I think this may prevent wierd edgecase errors like adding to the 31st day of a month\r\n        lDt.setMonth(lDt.getMonth() + delta);\r\n        this.render(lDt);\r\n    }\r\n\r\n\r\n\r\n    render(pDt)\r\n    {\r\n        var self = this, ctrl = self.curCtrl, ctrlDt = ctrl.value;\r\n\r\n        var dt = pDt || ctrlDt || new Date();\r\n        dt = new Date(dt.getTime());                     //Ensure we work with a clone if using the ctrl's date\r\n\r\n        var month       = dt.getMonth();\r\n        var year        = dt.getFullYear();\r\n        var firstDayDt  = new Date(year, month, 1);      //1st date of the month\r\n        var startDay    = firstDayDt.getDay();           //That date's day number (0-6)\r\n        var todayDt     = new Date();                    //Today's date\r\n        var today       = -1;                            //Today's day number. -1 if today's date doesn't fall within the calendar month we are rendering.\r\n        var activeDay   = -1;                            //Day number of the currently selected date. -1 if one doesn't exist within the calendar month we are rendering.\r\n\r\n        //Record that this was the last date we rendered with\r\n        self.lastDt = dt;\r\n\r\n        //Get total days in the month\r\n        dt = new Date(year, month + 1, 0);\r\n        var daysInMonth = dt.getDate();\r\n        \r\n        //Explanation of the above:\r\n        //Date constructor attempts to convert year/month/day values to the nearest valid date. Month is incremented to get the following month, then a Date object is created with zero days. \r\n        //Since this is invalid, the Date object defaults to the last valid day of the previous month which is the month we're actually interested in. \r\n        //Then getDate() returns the day (1-31) of that date, & that gives us the number of days in that month. As a bonus this handles leap year too.\r\n        \r\n\r\n        //Determine if the month we're rendering includes today's date\r\n        if(month == todayDt.getMonth() && year == todayDt.getFullYear())\r\n        {\r\n            today = todayDt.getDate();\r\n        }\r\n        \r\n        //Determine if the month we're rendering includes the currently selected date\r\n        if(ctrlDt && month == ctrlDt.getMonth() && year == ctrlDt.getFullYear())\r\n        {\r\n            activeDay = ctrlDt.getDate();\r\n        }\r\n        \r\n        var html = `<div class='cs-cal-hdr'>\r\n                        <a class='` + PrevButtonCSS + `'><i class='cs-cal-prev-ico'></i></a>\r\n                        <div class='cs-cal-title'>` + MonthName[month] + ' ' + year + `</div>\r\n                        <a class='` + NextButtonCSS + `'><i class='cs-cal-next-ico'></i></a>\r\n                    </div>\r\n                    <table class='cs-cal-tbl'>\r\n                        <tr class='cs-cal-dayrow'>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Su</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Mo</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Tu</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>We</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Th</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Fr</span></th>\r\n                          <th class='cs-cal-daycell'><span class='cs-cal-daylbl'>Sa</span></th>\r\n                        </tr><tr>`;\r\n\r\n        //Build day cells\r\n        var w = 0, d, dayCount = 1;\r\n        for (; w < 6; w++)           //Week loop (6 rows may be more than we need. We'll break out before if so.)\r\n        {\r\n            for (d = 0; d < 7; d++)  //Day loop (cells)\r\n            {\r\n                if (dayCount <= daysInMonth && (w > 0 || d >= startDay))       //Fill the cell if we still have days left, & we're not on the 1st row, or this day is >= the starting day for the month\r\n                {\r\n                    html += \"<td class='cs-cal-cell\";\r\n                    \r\n                    if(dayCount == activeDay) { html += \" cs-active\"; }        //Currently selected day\r\n                    \r\n                    html += \"'><div class='cs-cal-cell-content\";\r\n                    \r\n                    if(dayCount == today)  { html += \" cs-today\"; }            //Today's date cell\r\n                    \r\n                    html += \"'>\" + dayCount + \"</div></td>\"; \r\n                    dayCount++;\r\n                }\r\n                else\r\n                {\r\n                    html += '<td class=\"cs-cal-cell cs-cal-cell-blank\"></td>'; //Empty cell\r\n                }\r\n            }\r\n            if(dayCount > daysInMonth) { break; }\r\n            html += \"</tr><tr>\";\r\n        }\r\n        html += \"</tr></table>\";\r\n\r\n        self.element.innerHTML = html;\r\n    }\r\n    \r\n    position()\r\n    {\r\n        var ctrlEl      = this.curCtrl.element,         //The DOM element for the control we are attaching this DDL to\r\n            ctrlPos     = chs.jqOffset(ctrlEl),         //Coordinates relative to the document\r\n            cal         = this.element,                 //The calendar element\r\n            ctrlHeight  = ctrlEl.offsetHeight,          //Height of the control we're attached to\r\n            y           = ctrlPos.top + ctrlHeight,     //Y position directly below ctrl\r\n            wh          = window.innerHeight,           //Height of the browser viewport including, if rendered, the horizontal scrollbar\r\n            topSpace    = ctrlPos.top,                  //Space available above ctrl\r\n            botSpace    = (wh - y);                     //Space available below ctrl\r\n            \r\n\r\n        //Set cal left position\r\n        cal.style.left = ctrlPos.left + 'px';\r\n       \r\n        //If cal would extend beyond the window assume it's better to show above the control *IF* topSpace has more room\r\n        if ((y + cal.offsetHeight) > wh) \r\n        {\r\n            if (topSpace > botSpace) //Top space has more room so put above the ctrl\r\n            {\r\n                //borderTop = true;\r\n                y = ctrlPos.top - cal.offsetHeight - 1;\r\n            }\r\n        }\r\n \r\n        //Set top position\r\n        cal.style.top = y + 'px';\r\n    }\r\n}"],"sourceRoot":"/source/"}